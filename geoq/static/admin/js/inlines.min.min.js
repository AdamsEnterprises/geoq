(function(a){a.fn.formset=function(q){var r=a.extend({},a.fn.formset.defaults,q),p=a(this);q=p.parent();var i=function(h,k,e){var d=new RegExp("("+k+"-(\\d+|__prefix__))");k=k+"-"+e;a(h).prop("for")&&a(h).prop("for",a(h).prop("for").replace(d,k));h.id&&(h.id=h.id.replace(d,k));h.name&&(h.name=h.name.replace(d,k))},o=a("#id_"+r.prefix+"-TOTAL_FORMS").prop("autocomplete","off"),f=parseInt(o.val(),10),n=a("#id_"+r.prefix+"-MAX_NUM_FORMS").prop("autocomplete","off"),j=""===n.val()||0<n.val()-o.val();p.each(function(b){a(this).not("."+r.emptyCssClass).addClass(r.formCssClass)});if(p.length&&j){var c;"TR"===p.prop("tagName")?(p=this.eq(-1).children().length,q.append('<tr class="'+r.addCssClass+'"><td colspan="'+p+'"><a href="#">'+r.addText+"</a></tr>"),c=q.find("tr:last a")):(p.filter(":last").after('<div class="'+r.addCssClass+'"><a href="#">'+r.addText+"</a></div>"),c=p.filter(":last").next().find("a"));c.click(function(d){d.preventDefault();d=a("#"+r.prefix+"-empty");var e=d.clone(!0);e.removeClass(r.emptyCssClass).addClass(r.formCssClass).attr("id",r.prefix+"-"+f);e.is("tr")?e.children(":last").append('<div><a class="'+r.deleteCssClass+'" href="#">'+r.deleteText+"</a></div>"):e.is("ul")||e.is("ol")?e.append('<li><a class="'+r.deleteCssClass+'" href="#">'+r.deleteText+"</a></li>"):e.children(":first").append('<span><a class="'+r.deleteCssClass+'" href="#">'+r.deleteText+"</a></span>");e.find("*").each(function(){i(this,r.prefix,o.val())});e.insertBefore(a(d));a(o).val(parseInt(o.val(),10)+1);f+=1;""!==n.val()&&0>=n.val()-o.val()&&c.parent().hide();e.find("a."+r.deleteCssClass).click(function(g){g.preventDefault();e.remove();--f;r.removed&&r.removed(e);a(document).trigger("formset:removed",[e,r.prefix]);g=a("."+r.formCssClass);a("#id_"+r.prefix+"-TOTAL_FORMS").val(g.length);(""===n.val()||0<n.val()-g.length)&&c.parent().show();var k,m,l=function(){i(this,r.prefix,k)};k=0;for(m=g.length;k<m;k++){i(a(g).get(k),r.prefix,k),a(g.get(k)).find("*").each(l)}});r.added&&r.added(e);a(document).trigger("formset:added",[e,r.prefix])})}return this};a.fn.formset.defaults={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",emptyCssClass:"empty-row",formCssClass:"dynamic-form",added:null,removed:null};a.fn.tabularFormset=function(c){var f=a(this),i=function(d){a(f.selector).not(".add-row").removeClass("row1 row2").filter(":even").addClass("row1").end().filter(":odd").addClass("row2")},g=function(){"undefined"!==typeof SelectFilter&&(a(".selectfilter").each(function(e,j){var d=j.name.split("-");SelectFilter.init(j.id,d[d.length-1],!1)}),a(".selectfilterstacked").each(function(e,j){var d=j.name.split("-");SelectFilter.init(j.id,d[d.length-1],!0)}))},h=function(b){b.find(".prepopulated_field").each(function(){var e=a(this).find("input, select, textarea"),j=e.data("dependency_list")||[],k=[];a.each(j,function(l,d){k.push("#"+b.find(".field-"+d).find("input, select, textarea").attr("id"))});k.length&&e.prepopulate(k,e.attr("maxlength"))})};f.formset({prefix:c.prefix,addText:c.addText,formCssClass:"dynamic-"+c.prefix,deleteCssClass:"inline-deletelink",deleteText:c.deleteText,emptyCssClass:"empty-form",removed:i,added:function(b){h(b);"undefined"!==typeof DateTimeShortcuts&&(a(".datetimeshortcuts").remove(),DateTimeShortcuts.init());g();i(b)}});return f};a.fn.stackedFormset=function(c){var f=a(this),i=function(d){a(f.selector).find(".inline_label").each(function(b){b+=1;a(this).html(a(this).html().replace(/(#\d+)/g,"#"+b))})},g=function(){"undefined"!==typeof SelectFilter&&(a(".selectfilter").each(function(e,j){var d=j.name.split("-");SelectFilter.init(j.id,d[d.length-1],!1)}),a(".selectfilterstacked").each(function(e,j){var d=j.name.split("-");SelectFilter.init(j.id,d[d.length-1],!0)}))},h=function(b){b.find(".prepopulated_field").each(function(){var j=a(this).find("input, select, textarea"),l=j.data("dependency_list")||[],k=[];a.each(l,function(d,e){k.push("#"+b.find(".form-row .field-"+e).find("input, select, textarea").attr("id"))});k.length&&j.prepopulate(k,j.attr("maxlength"))})};f.formset({prefix:c.prefix,addText:c.addText,formCssClass:"dynamic-"+c.prefix,deleteCssClass:"inline-deletelink",deleteText:c.deleteText,emptyCssClass:"empty-form",removed:i,added:function(b){h(b);"undefined"!==typeof DateTimeShortcuts&&(a(".datetimeshortcuts").remove(),DateTimeShortcuts.init());g();i(b)}});return f};a(document).ready(function(){a(".js-inline-admin-formset").each(function(){var c=a(this).data(),d=c.inlineFormset;switch(c.inlineType){case"stacked":a(d.name+"-group .inline-related").stackedFormset(d.options);break;case"tabular":a(d.name+"-group .tabular.inline-related tbody tr").tabularFormset(d.options)}})})})(django.jQuery);